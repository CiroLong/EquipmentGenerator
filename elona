import React, { useState } from 'react';
import { Sword, Shield, Sparkles, RefreshCw } from 'lucide-react';

const EquipmentGenerator = () => {
  // å½¢å®¹è¯è¯åº“
  const adjectives = [
    'ä¼ è¯´', 'å²è¯—', 'ç¨€æœ‰',
    'ç¥åœ£', 'é»‘æš—', 'ç«ç„°', 'å†°éœœ', 'é›·ç”µ',
    'å…‰æ˜', 'æš—å½±', 'è¡€è…¥', 'é”‹åˆ©', 'åšå›º',
    'é­”æ³•', 'è¿œå¤', 'ç¦å¿Œ', 'ç¥ç§˜', 'å¼ºåŒ–',
    'ç ´æŸ', 'ç”Ÿé”ˆ', 'é—ªè€€', 'è¯…å’’', 'ç¥ç¦',
    'é¾™é³', 'å‡¤ç¾½', 'æ˜Ÿè¾°', 'æœˆå½±', 'æ—¥ç‚',
    'é£æš´', 'å¤§åœ°', 'æµ·æ´‹', 'å¤©ç©º', 'åœ°ç‹±',
    'å¤©å ‚', 'è™šç©º', 'æ··æ²Œ', 'ç§©åº', 'æ°¸æ’'
  ];

  // ä¸»å±æ€§è¯åº“
  const mainAttributes = ['åŠ›é‡', 'ä½“è´¨', 'çµå·§', 'æ„ŸçŸ¥', 'é­”åŠ›', 'æ„å¿—'];
  
  // é«˜çº§å±æ€§è¯åº“ï¼ˆç”Ÿæˆæ¦‚ç‡ä½ï¼‰
  const advancedAttributes = ['é€Ÿåº¦', 'è¿æ°”'];

  // æŠ€èƒ½è¯åº“ - æŒ‰å±æ€§åˆ†ç±»
  const skillsByAttribute = {
    'åŠ›é‡': ['é•¿å‰‘ä¸“ç²¾', 'æ–§ä¸“ç²¾', 'æ ¼æ–—æŠ€å·§', 'é•°åˆ€ä¸“ç²¾', 'åŒæ‰‹æ­¦å™¨', 'æˆ˜æœ¯', 'ä¸¾é‡', 'é“åŒ ', 'æ ½åŸ¹'],
    'ä½“è´¨': ['æ–ä¸“ç²¾', 'é•¿æ†ä¸“ç²¾', 'é’å™¨ä¸“ç²¾', 'ç›¾ä¸“ç²¾', 'ä¸­è£…å¤‡', 'é‡è£…å¤‡', 'æœ¨åŒ ', 'é‡‡æ˜', 'æ²»æ„ˆ'],
    'çµå·§': ['çŸ­å‰‘ä¸“ç²¾', 'äºŒåˆ€æµ', 'å¼“ä¸“ç²¾', 'å¼©ä¸“ç²¾', 'æŠ•æ·æŠ€å·§', 'è½»è£…å¤‡', 'ç²¾é€šé—ªé¿', 'æœç´¢', 'å®çŸ³åŠ å·¥', 'è£ç¼', 'å¼€é”', 'è§£é™¤é™·é˜±'],
    'æ„ŸçŸ¥': ['æªæ¢°ä¸“ç²¾', 'è¿œç¨‹æ­¦å™¨ä¸“ç²¾', 'å¿ƒçœ¼', 'è‡ªç„¶å­¦è¯†', 'æ½œè¡Œ', 'å‚é’“', 'é‰´å®š', 'ä¾¦æŸ¥', 'æ¼”å¥', 'å…ƒç´ ç²¾çµå¼ºåŒ–'],
    'é­”åŠ›': ['é­”æ³•ä¿®è¡Œ', 'å…ƒç´ å¼•å¯¼', 'æš—å½±æœ¯', 'ç»“ç•Œæœ¯', 'ä»ªå¼', 'ç‚¼é‡‘æœ¯', 'çƒ¹é¥ª', 'è§£å‰–å­¦', 'è¯»ä¹¦', 'åŸºå› å­¦'],
    'æ„å¿—': ['æ¢å¤æœ¯', 'ç¥ç¦æœ¯', 'æ‹›é­‚æœ¯', 'ç²¾ç¥æ§åˆ¶', 'é»˜è®°', 'é­”åŠ›æé™', 'äº¤æ¶‰', 'èµåŠ©', 'å†¥æƒ³', 'éª‘ä¹˜', 'æ—…è¡Œ', 'ä¿¡ä»°']
  };

  // è·å–æ‰€æœ‰æŠ€èƒ½åˆ—è¡¨
  const allSkills = Object.values(skillsByAttribute).flat();

  // åè¯è¯åº“ï¼ˆè£…å¤‡ç±»å‹ï¼‰
  const nouns = [
    'é•¿å‰‘', 'çŸ­å‰‘', 'å·¨å‰‘', 'åŒ•é¦–', 'æ³•æ–',
    'ç›¾ç‰Œ', 'æˆ˜é”¤', 'é•¿å¼“', 'å¼©ç®­', 'æ³•çƒ',
    'å¤´ç›”', 'èƒ¸ç”²', 'æŠ¤è…¿', 'æˆ˜é´', 'æ‰‹å¥—',
    'é¡¹é“¾', 'æˆ’æŒ‡', 'è€³ç¯', 'è…°å¸¦', 'æŠ¤ç¬¦',
    'æ–—ç¯·', 'é•¿è¢', 'çš®ç”²', 'é”ç”²', 'æ¿ç”²',
    'æˆ˜æ–§', 'é•¿æª', 'ä¸‰å‰æˆŸ', 'é­”æ–', 'æ°´æ™¶çƒ',
    'æŠ¤è…•', 'è‚©ç”²', 'é¢å…·', 'ç‹å† ', 'æƒæ–'
  ];

  const [currentEquipment, setCurrentEquipment] = useState(null);
  const [equipmentHistory, setEquipmentHistory] = useState([]);

  // ç”Ÿæˆé™„é­”è¯æ¡
  const generateEnchantment = () => {
    // 30%æ¦‚ç‡ç”Ÿæˆå±æ€§è¯æ¡ï¼Œ70%æ¦‚ç‡ç”ŸæˆæŠ€èƒ½è¯æ¡
    const isAttributeEnchantment = Math.random() < 0.3;
    
    if (isAttributeEnchantment) {
      // ç”Ÿæˆå±æ€§è¯æ¡
      // 10%æ¦‚ç‡é«˜çº§å±æ€§ï¼Œ90%æ¦‚ç‡ä¸»å±æ€§
      const isAdvanced = Math.random() < 0.1;
      const attributePool = isAdvanced ? advancedAttributes : mainAttributes;
      const attribute = attributePool[Math.floor(Math.random() * attributePool.length)];
      const level = Math.floor(Math.random() * 20) + 1; // 1-20
      
      return {
        type: 'attribute',
        name: attribute,
        level,
        isAdvanced,
        display: `${attribute}+${level}`,
        category: 'å±æ€§è¯æ¡'
      };
    } else {
      // ç”ŸæˆæŠ€èƒ½è¯æ¡
      const attributeKeys = Object.keys(skillsByAttribute);
      const randomAttribute = attributeKeys[Math.floor(Math.random() * attributeKeys.length)];
      const skillsInCategory = skillsByAttribute[randomAttribute];
      const skill = skillsInCategory[Math.floor(Math.random() * skillsInCategory.length)];
      const level = Math.floor(Math.random() * 20) + 1; // 1-20
      
      return {
        type: 'skill',
        name: skill,
        level,
        belongsTo: randomAttribute,
        display: `${skill}+${level}`,
        category: 'æŠ€èƒ½è¯æ¡'
      };
    }
  };

  // è·å–è£…å¤‡å“è´¨
  const getQuality = (adjective) => {
    if (adjective === 'ä¼ è¯´') return 'legendary';
    if (adjective === 'å²è¯—') return 'epic';
    if (adjective === 'ç¨€æœ‰') return 'rare';
    
    // å…¶ä»–å½¢å®¹è¯æŒ‰æ¦‚ç‡åˆ†é…å“è´¨
    const rand = Math.random();
    if (rand < 0.1) return 'legendary';      // 10%æ¦‚ç‡ä¼ è¯´
    else if (rand < 0.3) return 'epic';      // 20%æ¦‚ç‡å²è¯—  
    else return 'rare';                      // 70%æ¦‚ç‡ç¨€æœ‰
  };

  // æ ¹æ®å“è´¨ç”Ÿæˆé™„é­”è¯æ¡
  const generateEnchantments = (quality) => {
    let enchantmentCount = 0;
    
    if (quality === 'legendary') {
      enchantmentCount = Math.random() < 0.5 ? 2 : 3; // 50%æ¦‚ç‡2ä¸ªï¼Œ50%æ¦‚ç‡3ä¸ª
    } else if (quality === 'epic') {
      enchantmentCount = Math.random() < 0.5 ? 2 : 3; // 50%æ¦‚ç‡2ä¸ªï¼Œ50%æ¦‚ç‡3ä¸ª
    } else if (quality === 'rare') {
      enchantmentCount = Math.random() < 0.7 ? 1 : 2; // 70%æ¦‚ç‡1ä¸ªï¼Œ30%æ¦‚ç‡2ä¸ª
    }

    const enchantments = [];
    const usedNames = new Set();

    for (let i = 0; i < enchantmentCount; i++) {
      let attempts = 0;
      let enchantment;
      
      // ç¡®ä¿ä¸é‡å¤åç§°
      do {
        enchantment = generateEnchantment();
        attempts++;
      } while (usedNames.has(enchantment.name) && attempts < 20);
      
      if (!usedNames.has(enchantment.name)) {
        usedNames.add(enchantment.name);
        enchantments.push(enchantment);
      }
    }

    return enchantments;
  };

  // éšæœºç”Ÿæˆè£…å¤‡
  const generateEquipment = () => {
    const randomAdjective = adjectives[Math.floor(Math.random() * adjectives.length)];
    const randomNoun = nouns[Math.floor(Math.random() * nouns.length)];
    const quality = getQuality(randomAdjective);
    const enchantments = generateEnchantments(quality);
    
    const newEquipment = {
      id: Date.now(),
      name: `${randomAdjective}çš„${randomNoun}`,
      adjective: randomAdjective,
      noun: randomNoun,
      quality,
      enchantments,
      timestamp: new Date().toLocaleTimeString()
    };

    setCurrentEquipment(newEquipment);
    setEquipmentHistory(prev => [newEquipment, ...prev.slice(0, 9)]); // ä¿ç•™æœ€è¿‘10ä¸ª
  };

  // è·å–è£…å¤‡ç¨€æœ‰åº¦é¢œè‰²
  const getRarityColor = (quality) => {
    const rarityColors = {
      'legendary': 'text-orange-500',
      'epic': 'text-purple-500', 
      'rare': 'text-blue-500'
    };
    return rarityColors[quality] || 'text-blue-500';
  };

  // è·å–å“è´¨èƒŒæ™¯è‰²
  const getQualityBg = (quality) => {
    const qualityBgs = {
      'legendary': 'bg-gradient-to-r from-orange-600/20 to-yellow-600/20 border-orange-500/50',
      'epic': 'bg-gradient-to-r from-purple-600/20 to-pink-600/20 border-purple-500/50',
      'rare': 'bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border-blue-500/50'
    };
    return qualityBgs[quality] || 'bg-gradient-to-r from-blue-600/20 to-cyan-600/20 border-blue-500/50';
  };

  // è·å–è£…å¤‡å›¾æ ‡
  const getEquipmentIcon = (noun) => {
    if (noun.includes('å‰‘') || noun.includes('æ–§') || noun.includes('é”¤') || noun.includes('æª')) {
      return <Sword className="w-6 h-6" />;
    } else if (noun.includes('ç›¾') || noun.includes('ç”²') || noun.includes('ç›”')) {
      return <Shield className="w-6 h-6" />;
    } else {
      return <Sparkles className="w-6 h-6" />;
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 p-4">
      <div className="max-w-4xl mx-auto">
        {/* æ ‡é¢˜ */}
        <div className="text-center mb-8">
          <h1 className="text-4xl font-bold text-white mb-2">âš”ï¸ è£…å¤‡ç”Ÿæˆå™¨</h1>
          <p className="text-gray-300">éšæœºç”Ÿæˆæ¸¸æˆè£…å¤‡åç§°</p>
        </div>

        {/* ç”ŸæˆæŒ‰é’® */}
        <div className="text-center mb-8">
          <button
            onClick={generateEquipment}
            className="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white px-8 py-4 rounded-lg font-semibold text-lg shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2 mx-auto"
          >
            <RefreshCw className="w-5 h-5" />
            ç”Ÿæˆè£…å¤‡
          </button>
        </div>

        {/* å½“å‰ç”Ÿæˆçš„è£…å¤‡ */}
        {currentEquipment && (
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-8 border border-white/20">
            <div className="text-center">
              <h2 className="text-xl text-gray-300 mb-4">âœ¨ æ–°ç”Ÿæˆçš„è£…å¤‡</h2>
              <div className={`flex flex-col items-center gap-4 rounded-lg p-6 border-2 ${getQualityBg(currentEquipment.quality)}`}>
                <div className="flex items-center gap-4">
                  <div className={getRarityColor(currentEquipment.quality)}>
                    {getEquipmentIcon(currentEquipment.noun)}
                  </div>
                  <div>
                    <div className={`text-2xl font-bold ${getRarityColor(currentEquipment.quality)}`}>
                      {currentEquipment.name}
                    </div>
                    <div className="text-sm text-gray-400 mt-1">
                      ç”Ÿæˆæ—¶é—´: {currentEquipment.timestamp}
                    </div>
                  </div>
                </div>
                
                {/* é™„é­”è¯æ¡æ˜¾ç¤º */}
                {currentEquipment.enchantments && currentEquipment.enchantments.length > 0 && (
                  <div className="w-full">
                    <div className="text-sm text-gray-300 mb-2">é™„é­”è¯æ¡:</div>
                    <div className="space-y-2">
                      {currentEquipment.enchantments.map((enchantment, index) => (
                        <div 
                          key={index}
                          className={`text-sm px-3 py-2 rounded-lg ${getEnchantmentStyle(enchantment)}`}
                        >
                          <div className="flex items-center justify-between">
                            <span className="font-medium">{enchantment.display}</span>
                            <span className="text-xs opacity-70">
                              {enchantment.category}
                              {enchantment.type === 'skill' && ` (${enchantment.belongsTo}ç³»)`}
                            </span>
                          </div>
                        </div>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          </div>
        )}

        {/* ç”Ÿæˆå†å² */}
        {equipmentHistory.length > 0 && (
          <div className="bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-white/20">
            <h3 className="text-xl font-semibold text-white mb-4">ğŸ“œ ç”Ÿæˆå†å²</h3>
            <div className="grid gap-3">
              {equipmentHistory.map((equipment, index) => (
                <div
                  key={equipment.id}
                  className={`rounded-lg p-4 border-2 ${getQualityBg(equipment.quality)} hover:scale-[1.02] transition-transform`}
                >
                  <div className="flex items-start gap-3">
                    <div className={getRarityColor(equipment.quality)}>
                      {getEquipmentIcon(equipment.noun)}
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center justify-between">
                        <div className={`font-semibold ${getRarityColor(equipment.quality)}`}>
                          {equipment.name}
                        </div>
                        <div className="text-xs text-gray-500">
                          #{equipmentHistory.length - index}
                        </div>
                      </div>
                      <div className="text-xs text-gray-400 mb-2">
                        {equipment.timestamp}
                      </div>
                      
                      {/* å†å²è£…å¤‡çš„é™„é­”è¯æ¡ */}
                      {equipment.enchantments && equipment.enchantments.length > 0 && (
                        <div className="flex flex-wrap gap-1 mt-2">
                          {equipment.enchantments.map((enchantment, enchantmentIndex) => (
                            <span 
                              key={enchantmentIndex}
                              className={`text-xs px-2 py-1 rounded ${getEnchantmentStyle(enchantment)}`}
                              title={`${enchantment.category}${enchantment.type === 'skill' ? ` (${enchantment.belongsTo}ç³»)` : ''}`}
                            >
                              {enchantment.display}
                            </span>
                          ))}
                        </div>
                      )}
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )}

        {/* é™„é­”è¯æ¡ä¿¡æ¯ */}
        <div className="mt-8 grid md:grid-cols-2 gap-6">
          <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
            <h4 className="text-lg font-semibold text-white mb-3">ğŸ¯ å±æ€§è¯æ¡</h4>
            <div className="space-y-2 text-sm">
              <div>
                <span className="text-green-300">ä¸»å±æ€§</span>
                <span className="text-gray-400 ml-2">({mainAttributes.length}ä¸ª): {mainAttributes.join('ã€')}</span>
              </div>
              <div>
                <span className="text-yellow-300">é«˜çº§å±æ€§</span>
                <span className="text-gray-400 ml-2">({advancedAttributes.length}ä¸ª): {advancedAttributes.join('ã€')}</span>
              </div>
              <div className="text-xs text-gray-500 mt-2">
                â€¢ å±æ€§è¯æ¡èŒƒå›´: +1 ~ +20<br/>
                â€¢ ä¸»å±æ€§ç”Ÿæˆæ¦‚ç‡: 90%<br/>
                â€¢ é«˜çº§å±æ€§ç”Ÿæˆæ¦‚ç‡: 10%
              </div>
            </div>
          </div>
          <div className="bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
            <h4 className="text-lg font-semibold text-white mb-3">âš”ï¸ æŠ€èƒ½è¯æ¡</h4>
            <div className="space-y-1 text-xs">
              {Object.entries(skillsByAttribute).map(([attr, skills]) => (
                <div key={attr} className="flex">
                  <span className="text-gray-300 w-12 shrink-0">{attr}:</span>
                  <span className="text-gray-400 text-xs">{skills.join('ã€')}</span>
                </div>
              ))}
            </div>
            <div className="text-xs text-gray-500 mt-2">
              â€¢ æŠ€èƒ½è¯æ¡èŒƒå›´: +1 ~ +20<br/>
              â€¢ å…±{allSkills.length}ä¸ªæŠ€èƒ½ï¼ŒæŒ‰6ä¸ªå±æ€§åˆ†ç±»
            </div>
          </div>
        </div>

        {/* ç”Ÿæˆè§„åˆ™ */}
        <div className="mt-6 bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10">
          <h4 className="text-lg font-semibold text-white mb-3">ğŸ“‹ é™„é­”è¯æ¡ç”Ÿæˆè§„åˆ™</h4>
          <div className="grid md:grid-cols-2 gap-4 text-sm">
            <div>
              <div className="text-gray-300 mb-2">å“è´¨è¯æ¡æ•°é‡:</div>
              <div className="space-y-1 text-xs text-gray-400">
                <div><span className="text-orange-400">ä¼ è¯´</span>: 2-3ä¸ªè¯æ¡</div>
                <div><span className="text-purple-400">å²è¯—</span>: 2-3ä¸ªè¯æ¡</div>
                <div><span className="text-blue-400">ç¨€æœ‰</span>: 1-2ä¸ªè¯æ¡</div>
              </div>
            </div>
            <div>
              <div className="text-gray-300 mb-2">è¯æ¡ç±»å‹æ¦‚ç‡:</div>
              <div className="space-y-1 text-xs text-gray-400">
                <div>å±æ€§è¯æ¡: 30%æ¦‚ç‡</div>
                <div>æŠ€èƒ½è¯æ¡: 70%æ¦‚ç‡</div>
                <div>åŒè£…å¤‡ä¸é‡å¤è¯æ¡åç§°</div>
                <div>æŠ€èƒ½è¯æ¡æ˜¾ç¤ºå½’å±å±æ€§ç³»</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default EquipmentGenerator;